{
  "Logging": {
    "LogLevel": {
      "Default": "Warning",
      "Microsoft.AspNetCore": "Warning",
      "Microsoft.EntityFrameworkCore": "Error",
      "System.Net.Http.HttpClient": "Warning"
    }
  },
  "AllowedHosts": "*",
  
  "KeyVault": {
    "VaultUri": "${KEY_VAULT_URI}"
  },
  
  "ErpService": {
    "BaseUrl": "${ERP_BASE_URL}",
    "TimeoutSeconds": 15,
    "MaxRetries": 2,
    "ApiKey": "${ERP_API_KEY}"
  },
  
  "WarehouseService": {
    "BaseUrl": "${WAREHOUSE_BASE_URL}", 
    "TimeoutSeconds": 15,
    "MaxRetries": 2,
    "ApiKey": "${WAREHOUSE_API_KEY}"
  },
  
  "Cache": {
    "Enabled": true,
    "DefaultExpirationSeconds": 5,
    "GetProductsV1QueryExpirationSeconds": 5,
    "GetProductsV2QueryExpirationSeconds": 5,
    "GetProductQueryExpirationSeconds": 5,
    "GetProductV2QueryExpirationSeconds": 5
  },
  
  "CircuitBreaker": {
    "FailureThreshold": 10,
    "BreakDuration": "00:02:00",
    "SamplingDuration": 30
  },
  
  "Jwt": {
    "SecretKey": "${JWT_SECRET_KEY}",
    "Issuer": "IntegrationGateway",
    "Audience": "IntegrationGatewayClients",
    "ExpirationMinutes": 60,
    "ValidateIssuer": true,
    "ValidateAudience": true,
    "ValidateLifetime": true,
    "ValidateIssuerSigningKey": true
  },
  
  "ApplicationInsights": {
    "ConnectionString": "${APPLICATIONINSIGHTS_CONNECTION_STRING}",
    "InstrumentationKey": "${APPLICATIONINSIGHTS_INSTRUMENTATION_KEY}",
    "EnableAdaptiveSampling": true,
    "SamplingPercentage": 100.0,
    "EnableHeartbeat": true,
    "EnableQuickPulseMetricStream": true,
    "EnableDependencyTracking": true,
    "EnablePerformanceCounterCollection": true,
    "MaxTelemetryBufferCapacity": 500,
    "FlushOnDispose": true,
    "CloudRoleName": "IntegrationGateway",
    "CloudRoleInstance": "${HOSTNAME}",
    "CustomProperties": {
      "Environment": "Production",
      "Service": "IntegrationGateway",
      "Region": "${AZURE_REGION}",
      "Version": "${BUILD_VERSION}"
    }
  },
  
  "Idempotency": {
    "Enabled": true,
    "DefaultExpirationTime": "00:15:00",
    "SemaphoreTimeout": "00:00:03",
    "CleanupInterval": "00:05:00",
    "MaxConcurrentOperations": 50,
    "EnableCleanup": true,
    "HeaderName": "Idempotency-Key",
    "MinKeyLength": 16,
    "MaxKeyLength": 64
  },
  
  "HttpClient": {
    "UserAgent": "IntegrationGateway/1.0",
    "AcceptHeader": "application/json",
    "ContentTypeHeader": "application/json; charset=utf-8",
    "DefaultConnectionTimeoutSeconds": 10,
    "DefaultRequestTimeoutSeconds": 60,
    "EnableAutomaticDecompression": true,
    "MaxConnectionsPerServer": 50,
    "PoolConnectionLifetimeMinutes": 10,
    "DefaultHeaders": {
      "X-Request-Source": "IntegrationGateway",
      "X-Environment": "Production"
    }
  },
  
  "Security": {
    "Cors": {
      "Enabled": true,
      "AllowedOrigins": [
        "${FRONTEND_URL_1}",
        "${FRONTEND_URL_2}",
        "${ADMIN_PANEL_URL}"
      ],
      "AllowCredentials": false,
      "PreflightMaxAge": 3600
    },
    "RateLimiting": {
      "Enabled": true,
      "GeneralApi": {
        "PermitLimit": 100,
        "Window": "00:01:00",
        "QueueLimit": 10,
        "AutoReplenishment": "00:00:02"
      },
      "Authentication": {
        "PermitLimit": 10,
        "Window": "00:01:00", 
        "QueueLimit": 5,
        "AutoReplenishment": "00:00:10"
      },
      "WriteOperations": {
        "PermitLimit": 20,
        "Window": "00:01:00",
        "QueueLimit": 5,
        "AutoReplenishment": "00:00:05"
      }
    },
    "RequestLimits": {
      "MaxRequestBodySize": 2097152,
      "MaxRequestLineSize": 8192,
      "MaxRequestHeaders": 100,
      "MaxRequestHeadersTotalSize": 65536,
      "MaxRequestFormSize": 2097152
    },
    "SsrfProtection": {
      "Enabled": true,
      "AllowedDomains": [
        "${ERP_DOMAIN}",
        "${WAREHOUSE_DOMAIN}",
        "api.partner.com"
      ],
      "BlockPrivateNetworks": true,
      "BlockLocalhost": true,
      "CustomBlockedRanges": [
        "169.254.0.0/16",
        "224.0.0.0/4"
      ]
    }
  }
}